(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{148:function(e,t,n){},158:function(e,t,n){e.exports=n(308)},163:function(e,t,n){},308:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(7),c=n.n(o),i=(n(163),n(13)),l=n(14),u=n(17),s=n(15),p=n(18),d=n(109),E=n.n(d),f=n(43),O=n(24),y=n(156),m=n(312),h=n(16),N=n(112),I=n.n(N),T=(n(69),function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.type,a=t.node,o=!1;return a.parent&&"WHERE"===a.parent.type&&(o=!0),r.a.createElement(B.Consumer,null,function(t){return r.a.createElement("div",{className:"group-tool"},r.a.createElement(f.a,null,r.a.createElement(O.a,{onClick:function(){return t.changeNodeType(e.props.node,"FILTER_AND")},type:"FILTER_AND"===n?"primary":"default"},"\u4e14"),r.a.createElement(O.a,{onClick:function(){return t.changeNodeType(e.props.node,"FILTER_OR")},type:"FILTER_OR"===n?"primary":"default"},"\u6216")),"\xa0\xa0",r.a.createElement(f.a,{className:"ActionBtnGroup"},r.a.createElement(y.a,{trigger:["click"],overlay:r.a.createElement(m.a,{onClick:function(n){return t.addNode(n.key,e.props.node)}},r.a.createElement(I.a,{key:"rule"},r.a.createElement("span",{className:"TypeLabel"},"\u89c4\u5219")),r.a.createElement(I.a,{key:"group"},r.a.createElement("span",{className:"TypeLabel"},"\u89c4\u5219\u7ec4")))},r.a.createElement(O.a,null,r.a.createElement(h.a,{type:"plus"}),r.a.createElement("span",null,"\u6dfb\u52a0"),r.a.createElement(h.a,{type:"down"}))),r.a.createElement(O.a,{icon:"delete",type:"danger",disabled:o,onClick:function(){return t.removeNode(e.props.node)}},r.a.createElement("span",null,"\u5220\u9664\u7ec4")),r.a.createElement(O.a,{disabled:o,onClick:function(){t.collapseNode(e.props.node)}},"\u62c6\u5206")))})}}]),t}(r.a.Component)),g=(n(148),function(){return r.a.createElement("div",{className:"Guideline"})}),v=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.node,n=e.node.list;return n?r.a.createElement("div",{style:{marginLeft:40},className:"group"},r.a.createElement(a.Fragment,null,r.a.createElement(T,{type:"FILTER_AND",node:t}),r.a.createElement("div",null,r.a.createElement(g,null),n.map(function(e,t){return[r.a.createElement(V,{node:e,key:t})]})))):null}}]),t}(r.a.Component),R=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.node,n=e.node.list,a=e.errors;return n?r.a.createElement("div",{style:{marginLeft:40},className:"group"},r.a.createElement(T,{type:"FILTER_OR",node:t}),r.a.createElement("div",null,r.a.createElement(g,null),a&&a.has(t)?r.a.createElement("span",{className:"group-error"},a.get(t)):null,n.map(function(e,t){return[r.a.createElement(V,{node:e,key:t})]}))):null}}]),t}(r.a.Component),D=function(){return r.a.createElement("div",{className:"Splitline"})},C=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(B.Consumer,null,function(t){return r.a.createElement(f.a,null,r.a.createElement(O.a,{icon:"copy",onClick:function(){return t.copyNode(e.props.node)}}),r.a.createElement(O.a,{icon:"delete",type:"danger",onClick:function(){return t.removeNode(e.props.node)}}),r.a.createElement(O.a,{onClick:function(){t.collapseNode(e.props.node)}},r.a.createElement("span",{style:{margin:"0 -6px"}},"\u62c6")))})}}]),t}(r.a.Component),_=n(310),b=_.a.Option,j=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).typeChange=function(e){n.props.context.changeNodeType(n.props.node.action,e),n.props.context.clearNodeAction(n.props.node)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.node,t=e.action,n=e.range;return r.a.createElement("div",{className:"rule-tool"},r.a.createElement(D,null),r.a.createElement(_.a,{value:e.action.type,onChange:this.typeChange},[{key:"USER_ACTION",name:"\u7528\u6237"},{key:"TOPIC_ACTION",name:"\u8bdd\u9898"}].map(function(e){return r.a.createElement(b,{key:e.key,value:e.key},e.name)})),"\xa0 \xa0",r.a.createElement(V,{node:t}),n?r.a.createElement(V,{node:n}):null,r.a.createElement(C,{node:this.props.node}))}}]),t}(r.a.Component),A=n(309),L=n(9),F=n.n(L),k=A.a.RangePicker,w=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).dateChange=function(e,t){n.props.context.changeDateNodeValue(n.props.node.from,t[0]),n.props.context.changeDateNodeValue(n.props.node.to,t[1])},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.node,n=e.errors;if(!t)return null;var a=t.from,o=t.to;return r.a.createElement("span",{className:n&&n.has(t)?"has-error":""},"\u5728\xa0\xa0",r.a.createElement(k,{value:o.value?[F()(a.value),F()(o.value)]:void 0,showTime:!1,style:{width:240},onChange:this.dateChange}),"\xa0\xa0")}}]),t}(r.a.Component),S=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.errors,n=e.node,a=this.props.node.detail,o=a.action,c=a.target;return r.a.createElement("span",{className:t&&t.has(n)?"has-error":""},"\u5bf9\u7528\u6237\xa0\xa0",r.a.createElement(_.a,{value:c.id,placeholder:"\u8bf7\u9009\u62e9",style:{width:100}}),"\xa0\xa0 \u505a\u4e86 \xa0\xa0",r.a.createElement(_.a,{value:o.id,placeholder:"\u8bf7\u9009\u62e9",style:{width:100}}),"\xa0\xa0")}}]),t}(r.a.Component),U=_.a.Option,x=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={targetOptions:["1112","3334"],actionOptions:["awsl","ddddd"]},n.actionChange=function(e){n.props.context.changeIDNodeValue(n.props.node.detail.action,e)},n.targetChange=function(e){n.props.context.changeIDNodeValue(n.props.node.detail.target,e)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){this.setState({})}},{key:"render",value:function(){var e=this.props,t=e.errors,n=e.node,a=this.props.node.detail,o=a.action,c=a.target,i=this.state,l=i.targetOptions,u=i.actionOptions;return r.a.createElement("span",{className:t&&t.has(n)?"has-error":""},"\u5bf9\u8bdd\u9898\xa0\xa0",r.a.createElement(_.a,{value:c.id,placeholder:"\u8bf7\u9009\u62e9",style:{width:100},onChange:this.targetChange},l.map(function(e){return r.a.createElement(U,{key:e},e)})),"\xa0\xa0 \u505a\u4e86 \xa0\xa0",r.a.createElement(_.a,{value:o.id,placeholder:"\u8bf7\u9009\u62e9",style:{width:100},onChange:this.actionChange},u.map(function(e){return r.a.createElement(U,{key:e},e)})),"\xa0\xa0")}}]),t}(r.a.Component);function P(){return null}var V=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.node.type;if(!t)return null;var n=P;return"FILTER_AND"===t&&(n=v),"FILTER_OR"===t&&(n=R),"FILTER_NODE"===t&&(n=j),"USER_ACTION"===t&&(n=S),"TOPIC_ACTION"===t&&(n=x),"RANGE"===t&&(n=w),r.a.createElement(B.Consumer,null,function(t){return r.a.createElement(n,{node:e.props.node,errors:t.errors,context:t})})}}]),t}(r.a.Component),G=function(){function e(t,n){if(Object(i.a)(this,e),this.type="FILTER_NODE",this.parent=null,this.action={type:"TOPIC_ACTION",detail:{action:{id:void 0,type:"ID_NODE"},target:{id:void 0,type:"ID_NODE"}}},this.range={type:"RANGE",from:{value:void 0,type:"DATE"},to:{value:void 0,type:"DATE"}},this.parent=n,"TOPIC_ACTION"===t)this.action.type="TOPIC_ACTION";else{if("USER_ACTION"!==t)throw TypeError("Unexpected type for Rule constructor");this.action.type="USER_ACTION"}}return Object(l.a)(e,[{key:"clear",value:function(){this.action.detail={action:{id:void 0,type:"ID_NODE"},target:{id:void 0,type:"ID_NODE"}}}}]),e}(),M=function e(t,n){if(Object(i.a)(this,e),this.parent=null,this.type="FILTER_OR",this.list=[],this.parent=n,"FILTER_AND"===t)this.type="FILTER_AND";else{if("FILTER_OR"!==t)throw TypeError("Unexpected type for Group constructor");this.type="FILTER_OR"}},W=function(e){var t=e.conditions;return t.list&&(t.parent=e),function e(t){if(t.list)for(var n=0;n<t.list.length;n++)t.list[n].parent=t,e(t.list[n])}(t),e},H=function(e,t){return function e(n){if(n.list)for(var a=0;a<n.list.length;a++)t(n.list[a]),e(n.list[a]);"FILTER_NODE"===n.type&&(t(n.action),e(n.action))}(e.conditions),e},B=Object(a.createContext)({tree:null,errors:null}),z=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).moveNode=function(e,t){},n.addNode=function(e,t){if("rule"===e)t.list.push(new G("TOPIC_ACTION",t)),n.forceUpdate();else{if("group"!==e)throw TypeError("Unexpected node type, cannot be inserted");t.list.push(new M("FILTER_OR",t)),n.forceUpdate()}n.clearErrors()},n.collapseNode=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FILTER_OR",a=new M(t,e.parent),r=e.parent.list.findIndex(function(t){return t===e});e.type,e.parent.list[r]=a,a.list=[e],e.parent=a,n.forceUpdate()},n.changeNodeType=function(e,t){e.type=t,n.clearErrors()},n.changeIDNodeValue=function(e,t){e.id=t,n.clearErrors()},n.changeDateNodeValue=function(e,t){e.value=t,n.clearErrors()},n.clearNodeAction=function(e){"FILTER_NODE"===e.type&&G.prototype.clear.call(e),n.clearErrors()},n.removeNode=function(e){var t=e.parent.list.findIndex(function(t){return t===e});e.parent.list.splice(t,1),n.clearErrors()},n.copyNode=function(e){var t=e.parent.list.findIndex(function(t){return t===e});e.parent.list.splice(t,0,{type:"FILTER_NODE",action:E()(e.action),range:E()(e.range),parent:e.parent}),n.clearErrors()},n.getFieldsValue=function(){return!n.validateFieldsValue()&&n.state.tree},n.validateFieldsValue=function(){var e=new Map;return H(n.state.tree,function(t){"FILTER_AND"!==t.type&&"FILTER_OR"!==t.type||0===t.list.length&&e.set(t,"AND/OR\u7b5b\u9009\u5217\u8868\u4e0d\u80fd\u4e3a\u7a7a"),"USER_ACTION"!==t.type&&"TOPIC_ACTION"!==t.type||(t.detail.action.id||e.set(t,"\u52a8\u4f5c\u4e0d\u80fd\u8bbe\u7f6e\u4e3a\u7a7a"),t.detail.target.id||e.set(t,"\u76ee\u6807\u4e0d\u80fd\u8bbe\u7f6e\u4e3a\u7a7a"))}),n.setState({errors:e}),e.size?e:null},n.clearErrors=function(e){e?(n.state.errors.delete(e),n.forceUpdate()):n.setState({errors:null})},n.state={errors:null,tree:W(e.filters),moveNode:n.moveNode,addNode:n.addNode,collapseNode:n.collapseNode,removeNode:n.removeNode,copyNode:n.copyNode,clearNodeAction:n.clearNodeAction,clearErrors:n.clearErrors,changeIDNodeValue:n.changeIDNodeValue,changeDateNodeValue:n.changeDateNodeValue,changeNodeType:n.changeNodeType},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.tree.conditions;return e?r.a.createElement("div",null,r.a.createElement(B.Provider,{value:this.state},r.a.createElement(V,{node:e}))):null}}]),t}(r.a.Component),J=(n(305),n(307)),K=n(311),$=function e(t,n){var a=t.type,r={SELECT:{generate:function(t){return"SELECT ".concat(t.selectList.map(e)," FROM ").concat(e(t.source))}},COUNT:{generate:function(e){return"COUNT"}},SOURCE_LIST:{generate:function(t){return"".concat(t.source.map(function(e){return"ID ".concat(e.id)}).join(",")," ").concat(e(t.filters))}},WHERE:{generate:function(t){return null===t.conditions?"NULL":"WHERE ".concat(e(t.conditions,1))}},FILTER_AND:{generate:function(t,n){return 1===n?"".concat(t.list.map(function(t){return e(t)}).join(" \nAND ")):"(\n ".concat(t.list.map(function(t){return e(t)}).join(" \nAND ")," )")}},FILTER_OR:{generate:function(t,n){return 1===n?"".concat(t.list.map(function(t){return e(t)}).join(" \nOR ")):"(\n ".concat(t.list.map(function(t){return e(t)}).join(" \nOR ")," )")}},FILTER_NODE:{generate:function(t,n){return t.range?"".concat(e(t.action)," ").concat(e(t.range)):t.action?"".concat(e(t.action)):void 0}},USER_ACTION:{generate:function(t,n){return"USER DO ".concat(e(t.detail.action)," TO ").concat(e(t.detail.target))}},TOPIC_ACTION:{generate:function(t,n){return"TOPIC DO ".concat(e(t.detail.action)," TO ").concat(e(t.detail.target))}},ID_NODE:{generate:function(e){return e.comment?"ID ".concat(e.id," COMMENT `").concat(e.comment,"`"):"ID ".concat(e.id)}},RANGE:{generate:function(t){return"RANGE ".concat(e(t.from)," UNTIL ").concat(e(t.to))}},TIMESTAMP:{generate:function(e){return e.value}},DATE:{generate:function(e){return"`"+e.value+"`"}}};if(!r[a])throw console.info(a,r[a]),Error(a);return r[a].generate(t,n)},q={type:"SELECT",selectList:[{type:"COUNT"}],source:{type:"SOURCE_LIST",source:[{type:"SOURCE_NODE",id:"233"}],filters:{type:"WHERE",conditions:{type:"FILTER_AND",list:[{type:"FILTER_OR",list:[{type:"FILTER_NODE",action:{type:"USER_ACTION",detail:{action:{type:"ID_NODE",id:"1"},target:{type:"ID_NODE",id:"2",comment:"\u4f60\u662f\u4e0d\u662f\u50bb\u62a5\u8868"}}},range:{type:"RANGE",from:{type:"TIMESTAMP",value:123},to:{type:"TIMESTAMP",value:456}}},{type:"FILTER_NODE",action:{type:"USER_ACTION",detail:{action:{type:"ID_NODE",id:"13"},target:{type:"ID_NODE",id:"23"}}},range:{type:"RANGE",from:{type:"DATE",value:"2134123"},to:{type:"DATE",value:"23432434"}}}]},{type:"FILTER_OR",list:[{type:"FILTER_NODE",action:{type:"USER_ACTION",detail:{action:{type:"ID_NODE",id:"4"},target:{type:"ID_NODE",id:"5"}}}},{type:"FILTER_NODE",action:{type:"USER_ACTION",detail:{action:{type:"ID_NODE",id:"7"},target:{type:"ID_NODE",id:"8"}}}},{type:"FILTER_NODE",action:{type:"TOPIC_ACTION",detail:{action:{type:"ID_NODE",id:"7"},target:{type:"ID_NODE",id:"8"}}}},{type:"FILTER_AND",list:[{type:"FILTER_NODE",action:{type:"TOPIC_ACTION",detail:{action:{type:"ID_NODE",id:"7"},target:{type:"ID_NODE",id:"8"}}}},{type:"FILTER_NODE",action:{type:"TOPIC_ACTION",detail:{action:{type:"ID_NODE",id:"7"},target:{type:"ID_NODE",id:"8"}}}}]}]}]}}}},Q=function(e){function t(){var e,n;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).state={text:""},n.filterRef=Object(a.createRef)(),n.handleSubmit=function(){n.filterRef.current&&console.info(n.filterRef.current.getFieldsValue())},n.handleGenerate=function(){n.filterRef.current&&(!1!==n.filterRef.current.getFieldsValue()&&n.setState({text:$(n.filterRef.current.getFieldsValue())}))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"App"},r.a.createElement(z,{ref:this.filterRef,filters:q.source.filters}),r.a.createElement("div",null,r.a.createElement(J.a,{type:"primary",onClick:function(){return e.handleSubmit()}},"OK"),r.a.createElement(J.a,{onClick:function(){return e.handleGenerate()}},"generate")),r.a.createElement(K.a.TextArea,{value:this.state.text,autosize:!0}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},69:function(e,t,n){}},[[158,2,1]]]);
//# sourceMappingURL=main.chunk.js.map