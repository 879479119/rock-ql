{"version":3,"sources":["packages/rock-builder/Tools/GroupTools.tsx","packages/rock-builder/Tools/GuideLine.tsx","packages/rock-builder/Groups/AndGroup.tsx","packages/rock-builder/Groups/OrGroup.tsx","packages/rock-builder/Tools/SplitLine.tsx","packages/rock-builder/Tools/RuleTools.tsx","packages/rock-builder/Rules/ActionRule.tsx","packages/rock-builder/Rules/RangeRule.tsx","packages/rock-builder/Rules/UserActionRule.tsx","packages/rock-builder/Rules/TopicActionRule.tsx","packages/rock-builder/Framework/Entry.tsx","packages/rock-builder/Domain/Rule.ts","packages/rock-builder/Domain/Group.ts","packages/rock-builder/utils/traverse.ts","packages/rock-builder/Framework/index.tsx","packages/rock-builder/index.js","packages/rock-generator/index.js","App.tsx","serviceWorker.ts","index.tsx"],"names":["GroupTools","_this","this","_this$props","props","type","node","disabled","parent","react_default","a","createElement","FilterContext","Consumer","context","className","button_group","button_button","onClick","changeNodeType","dropdown","trigger","overlay","menu","item","addNode","key","MenuItem_default","icon","removeNode","collapseNode","React","Component","GuideLine","AndGroup","list","style","marginLeft","react","GroupTools_GroupTools","map","index","Entry_Entry","OrGroup","errors","has","get","SplitLine","RuleTools","copyNode","margin","Option","Select","ActionRule","typeChange","val","action","clearNodeAction","range","es_select","value","onChange","name","op","RuleTools_RuleTools","RangePicker","DatePicker","RangeRule","dateChange","_","strings","changeDateNodeValue","from","to","moment","undefined","showTime","width","UserActionRule","_this$props$node$deta","detail","target","id","placeholder","TopicActionRule","state","targetOptions","actionOptions","actionChange","changeIDNodeValue","targetChange","setState","_this$state","t","TopicActionRule_Option","Null","Entry","NodeComponent","Rule","Object","classCallCheck","TypeError","Group","assignParentNode","root","conditions","walk","walker","i","length","validateNodes","validator","createContext","tree","Framework","possibleConstructorReturn","getPrototypeOf","call","moveNode","push","forceUpdate","clearErrors","filter","arguments","group","findIndex","prototype","clear","splice","cloneDeep","getFieldsValue","validateFieldsValue","Map","set","size","delete","filters","Provider","depth","entries","SELECT","generate","n","concat","selectList","source","COUNT","SOURCE_LIST","join","WHERE","FILTER_AND","FILTER_OR","FILTER_NODE","USER_ACTION","TOPIC_ACTION","ID_NODE","comment","RANGE","TIMESTAMP","DATE","console","info","Error","sample","App","text","filterRef","createRef","handleSubmit","current","handleGenerate","_this2","rock_builder","ref","es_button","input","TextArea","autosize","Boolean","window","location","hostname","match","ReactDOM","render","src_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.chunk.js","sourcesContent":["import React, { ReactNode } from \"react\";\nimport Entry from \"../Framework/Entry\";\nimport { FilterContext } from \"../Framework\";\nimport ButtonGroup from \"antd/es/button/button-group\";\nimport Button from \"antd/es/button/button\";\nimport Dropdown from \"antd/es/dropdown/dropdown\";\nimport { Icon, Menu } from \"antd\";\nimport MenuItem from \"antd/lib/menu/MenuItem\";\nimport \"./index.css\";\n\ninterface Props {\n  type: string;\n  node: any;\n}\n\nexport default class GroupTools extends React.Component<Props, object> {\n  render(): ReactNode {\n    const { type, node } = this.props;\n    let disabled = false;\n    if (node.parent && node.parent.type === 'WHERE') {\n      disabled = true;\n    }\n\n    return (\n      <FilterContext.Consumer>\n        {(context: any) => {\n          return (\n            <div className=\"group-tool\">\n              <ButtonGroup>\n                <Button\n                  onClick={() =>\n                    context.changeNodeType(this.props.node, \"FILTER_AND\")\n                  }\n                  type={type === \"FILTER_AND\" ? \"primary\" : \"default\"}\n                >\n                  且\n                </Button>\n                <Button\n                  onClick={() =>\n                    context.changeNodeType(this.props.node, \"FILTER_OR\")\n                  }\n                  type={type === \"FILTER_OR\" ? \"primary\" : \"default\"}\n                >\n                  或\n                </Button>\n              </ButtonGroup>\n              &nbsp;&nbsp;\n              <ButtonGroup className=\"ActionBtnGroup\">\n                <Dropdown\n                  trigger={[\"click\"]}\n                  overlay={\n                    <Menu\n                      onClick={item =>\n                        context.addNode(item.key, this.props.node)\n                      }\n                    >\n                      <MenuItem key=\"rule\">\n                        <span className=\"TypeLabel\">规则</span>\n                      </MenuItem>\n                      <MenuItem key=\"group\">\n                        <span className=\"TypeLabel\">规则组</span>\n                      </MenuItem>\n                    </Menu>\n                  }\n                >\n                  <Button>\n                    <Icon type=\"plus\" />\n                    <span>添加</span>\n                    <Icon type=\"down\" />\n                  </Button>\n                </Dropdown>\n                <Button\n                  icon=\"delete\"\n                  type=\"danger\"\n                  disabled={disabled}\n                  onClick={() => context.removeNode(this.props.node)}\n                >\n                  <span>删除组</span>\n                </Button>\n                <Button\n                  disabled={disabled}\n                  onClick={() => {\n                    context.collapseNode(this.props.node);\n                  }}\n                >\n                  拆分\n                </Button>\n              </ButtonGroup>\n            </div>\n          );\n        }}\n      </FilterContext.Consumer>\n    );\n  }\n}\n","import React from 'react'\n\nimport './index.css'\n\nexport default function () {\n  return <div className=\"Guideline\" />\n}\n","import React, { ReactNode, Fragment } from \"react\";\nimport { DragSource, DropTarget } from \"react-dnd\";\nimport { TYPES } from \"../utils/constants\";\nimport { FilterContext } from '../Framework'\nimport Entry from \"../Framework/Entry\";\nimport GroupTools from \"../Tools/GroupTools\";\nimport \"./index.css\";\nimport GuideLine from \"../Tools/GuideLine\";\nimport SplitLine from \"../Tools/SplitLine\";\n\ninterface Props {\n  node: {\n    type: string;\n    list: {\n      type: string;\n      list: object[];\n    }[];\n  };\n  text: any;\n}\n\nexport default class AndGroup extends React.Component<Props, object> {\n  render(): ReactNode {\n    const {\n      node,\n      node: { list },\n    } = this.props;\n    if (!list) {\n      return null;\n    }\n\n    return (\n        <div style={{ marginLeft: 40 }} className=\"group\">\n          <Fragment>\n            <GroupTools type=\"FILTER_AND\" node={node} />\n            <div>\n              <GuideLine />\n              {list.map((item, index) => {\n                const ret = [<Entry node={item} key={index} />];\n                return ret;\n              })}\n            </div>\n          </Fragment>\n        </div>\n    );\n  }\n}\n\n","import React, {ReactNode} from 'react'\nimport Entry from '../Framework/Entry'\nimport GroupTools from \"../Tools/GroupTools\";\nimport  './index.css'\nimport GuideLine from \"../Tools/GuideLine\";\nimport SplitLine from \"../Tools/SplitLine\";\n\ninterface Props {\n  errors: any;\n  node: {\n    type: string\n    list: {\n      type: string\n      list: object[]\n    }[]\n  }\n}\n\nexport default class OrGroup extends React.Component<Props, object> {\n  render() : ReactNode {\n    const { node, node: {list}, errors } = this.props;\n\n    if (!list) {\n      return null\n    }\n\n    return (\n      <div style={{ marginLeft: 40 }} className=\"group\" >\n        {/*<SplitLine/>*/}\n        <GroupTools type=\"FILTER_OR\" node={node} />\n        <div>\n          <GuideLine/>\n          {\n            errors && errors.has(node) ? (\n              <span className=\"group-error\" >{errors.get(node)}</span>\n            ) : null\n          }\n          {\n            list.map((item, index) => {\n              const ret = [<Entry node={item} key={index} />]\n              // if (index !== 0) {\n              //   ret.unshift(<span>或</span>)\n              // }\n              return ret\n            })\n          }\n        </div>\n      </div>\n    )\n  }\n}\n","import React from 'react'\n\nimport './index.css'\n\nexport default function () {\n  return <div className=\"Splitline\" />\n}\n","import React, { ReactNode } from \"react\";\nimport Entry from \"../Framework/Entry\";\nimport ButtonGroup from \"antd/es/button/button-group\";\nimport Button from \"antd/es/button/button\";\nimport \"./index.css\";\nimport { FilterContext } from \"../Framework\";\n\ninterface Props {\n  node: any\n}\n\nexport default class RuleTools extends React.Component<Props, object> {\n  render(): ReactNode {\n    return (\n      <FilterContext.Consumer>\n        {(context: any) => {\n          return (\n            <ButtonGroup>\n              <Button icon=\"copy\" onClick={() => context.copyNode(this.props.node)}  />\n              <Button icon=\"delete\" type=\"danger\" onClick={() => context.removeNode(this.props.node)} />\n              <Button\n                onClick={() => {\n                  context.collapseNode(this.props.node);\n                }}\n              >\n                <span style={{ margin: \"0 -6px\" }}>拆</span>\n              </Button>\n            </ButtonGroup>\n          );\n        }}\n      </FilterContext.Consumer>\n    );\n  }\n}\n","import React, { ReactNode } from \"react\";\nimport Entry from \"../Framework/Entry\";\nimport SplitLine from \"../Tools/SplitLine\";\nimport RuleTools from \"../Tools/RuleTools\";\nimport { Select } from \"antd\";\n\nconst { Option } = Select;\n\ninterface Props {\n  context: any;\n  node: {\n    action: any;\n    range?: object;\n  };\n}\n\nexport default class ActionRule extends React.Component<Props, object> {\n  private typeChange: any = (val: string) => {\n    this.props.context.changeNodeType(this.props.node.action, val);\n    this.props.context.clearNodeAction(this.props.node);\n  };\n\n  render(): ReactNode {\n    const { node } = this.props;\n    const { action, range } = node;\n\n    const options = [\n      { key: \"USER_ACTION\", name: \"用户\" },\n      { key: \"TOPIC_ACTION\", name: \"话题\" }\n    ];\n\n    return (\n      <div className=\"rule-tool\">\n        <SplitLine />\n        <Select value={node.action.type} onChange={this.typeChange}>\n          {options.map(op => (\n            <Option key={op.key} value={op.key}>\n              {op.name}\n            </Option>\n          ))}\n        </Select>\n        &nbsp; &nbsp;\n        <Entry node={action} />\n        {range ? <Entry node={range} /> : null}\n        <RuleTools node={this.props.node} />\n      </div>\n    );\n  }\n}\n","import React, {ReactNode} from 'react'\nimport { DatePicker, Input } from 'antd'\nimport moment from \"moment\";\n\nconst { RangePicker } = DatePicker;\n\ninterface Props {\n  context: any;\n  errors: any;\n  node: {\n    type: string\n    from: {\n      type: string\n      value: string | number\n    }\n    to: {\n      type: string\n      value: string | number\n    }\n  }\n}\n\nexport default class RangeRule extends React.Component<Props, object> {\n  dateChange = (_: any, strings: [string, string]) => {\n    this.props.context.changeDateNodeValue(this.props.node.from, strings[0])\n    this.props.context.changeDateNodeValue(this.props.node.to, strings[1])\n  };\n  render() : ReactNode {\n    const { node, errors } = this.props;\n\n    if (!node) {\n      return null\n    }\n\n    const { from, to } = node;\n\n    return (\n      <span className={errors && errors.has(node) ? 'has-error' : ''} >\n        在&nbsp;&nbsp;\n        <RangePicker\n          value={to.value ? [moment(from.value), moment(to.value)] : undefined}\n          showTime={false}\n          style={{ width: 240}}\n          onChange={this.dateChange}\n        />\n        &nbsp;&nbsp;\n      </span>\n    )\n  }\n}\n","import React, {ReactNode} from 'react'\nimport { Select, Input } from 'antd'\nimport RuleTools from \"../Tools/RuleTools\";\n\ninterface Props {\n  errors: any;\n  node: {\n    type: string\n    detail: {\n      action: {\n        id: number | string\n      }\n      target: {\n        id: number | string\n      }\n    }\n  }\n}\n\nexport default class UserActionRule extends React.Component<Props, object> {\n  render() : ReactNode {\n    const { errors, node } = this.props;\n    const { action, target } = this.props.node.detail;\n\n    return (\n      <span className={errors && errors.has(node) ? 'has-error' : ''} >\n        对用户&nbsp;&nbsp;\n        <Select value={target.id} placeholder=\"请选择\" style={{ width: 100 }}  />\n        &nbsp;&nbsp;\n        做了\n        &nbsp;&nbsp;\n        <Select value={action.id} placeholder=\"请选择\" style={{ width: 100 }}  />\n        &nbsp;&nbsp;\n      </span>\n    )\n  }\n}\n","import React, { ReactNode } from \"react\";\nimport { Select, Input } from \"antd\";\nimport RuleTools from \"../Tools/RuleTools\";\n\nconst { Option } = Select;\n\ninterface Props {\n  context: any;\n  errors: any;\n  node: {\n    type: string;\n    detail: {\n      action: {\n        id: number | string;\n      };\n      target: {\n        id: number | string;\n      };\n    };\n  };\n}\n\nexport default class TopicActionRule extends React.Component<Props, object> {\n  state = {\n    targetOptions: [\"1112\", \"3334\"],\n    actionOptions: [\"awsl\", \"ddddd\"]\n  };\n  componentWillMount() {\n    this.setState({});\n  }\n  actionChange = (val: any) => {\n    this.props.context.changeIDNodeValue(this.props.node.detail.action, val)\n  };\n  targetChange = (val: any) => {\n    this.props.context.changeIDNodeValue(this.props.node.detail.target, val)\n  };\n  render(): ReactNode {\n    const { errors, node } = this.props;\n    const { action, target } = this.props.node.detail;\n    const { targetOptions, actionOptions } = this.state;\n\n    return (\n      <span className={errors && errors.has(node) ? \"has-error\" : \"\"}>\n        对话题&nbsp;&nbsp;\n        <Select\n          value={target.id}\n          placeholder=\"请选择\"\n          style={{ width: 100 }}\n          onChange={this.targetChange}\n        >\n          {targetOptions.map(t => (\n            <Option key={t}>{t}</Option>\n          ))}\n        </Select>\n        &nbsp;&nbsp; 做了 &nbsp;&nbsp;\n        <Select\n          value={action.id}\n          placeholder=\"请选择\"\n          style={{ width: 100 }}\n          onChange={this.actionChange}\n        >\n          {actionOptions.map(t => (\n            <Option key={t}>{t}</Option>\n          ))}\n        </Select>\n        &nbsp;&nbsp;\n      </span>\n    );\n  }\n}\n","import React, { ComponentClass, Fragment, ReactNode } from \"react\";\nimport AndGroup from \"../Groups/AndGroup\";\nimport OrGroup from \"../Groups/OrGroup\";\nimport { FilterContext } from \"./index\";\n\nimport ActionRule from \"../Rules/ActionRule\";\nimport RangeRule from \"../Rules/RangeRule\";\nimport UserActionRule from \"../Rules/UserActionRule\";\nimport TopicActionRule from \"../Rules/TopicActionRule\";\n\ninterface Props {\n  node: any;\n}\n\nfunction Null() {\n  return null;\n}\n\n/**\n * Facade Component\n */\nexport default class Entry extends React.Component<Props, object> {\n  render(): ReactNode {\n    const { type } = this.props.node;\n    if (!type) {\n      return null;\n    }\n\n    let NodeComponent: any = Null;\n\n    if (type === \"FILTER_AND\") {\n      NodeComponent = AndGroup;\n    }\n\n    if (type === \"FILTER_OR\") {\n      NodeComponent = OrGroup;\n    }\n    if (type === \"FILTER_NODE\") {\n      // 现在只有action一种\n      NodeComponent = ActionRule;\n    }\n\n    /**\n     * 上面这三种实际上是核心类型，可以进行拖拽\n     * 下面的几种是根据业务场景设计的组件\n     */\n\n    if (type === \"USER_ACTION\") {\n      NodeComponent = UserActionRule;\n    }\n    if (type === \"TOPIC_ACTION\") {\n      NodeComponent = TopicActionRule;\n    }\n    if (type === \"RANGE\") {\n      NodeComponent = RangeRule;\n    }\n\n    return (\n      <FilterContext.Consumer>\n        {context =>\n          React.createElement(NodeComponent, {\n            node: this.props.node,\n            errors: context.errors,\n            context\n          })\n        }\n      </FilterContext.Consumer>\n    );\n  }\n}\n","export default class Rule {\n  constructor(type: string, parent: any) {\n    this.parent = parent;\n    if (type === \"TOPIC_ACTION\") {\n      this.action.type = \"TOPIC_ACTION\";\n    } else if (type === \"USER_ACTION\") {\n      this.action.type = \"USER_ACTION\";\n    } else {\n      throw TypeError(\"Unexpected type for Rule constructor\");\n    }\n  }\n\n  type = \"FILTER_NODE\";\n  parent = null;\n  action = {\n    type: \"TOPIC_ACTION\",\n    detail: {\n      action: { id: undefined, type: 'ID_NODE' },\n      target: { id: undefined, type: 'ID_NODE' }\n    }\n  };\n  range = {\n    type: \"RANGE\",\n    from: { value: undefined, type: 'DATE' },\n    to: { value: undefined, type: 'DATE' }\n  };\n\n  clear() {\n    this.action.detail = {\n      action: { id: undefined, type: 'ID_NODE' },\n      target: { id: undefined, type: 'ID_NODE' }\n    };\n  }\n}\n","export default class Group {\n  constructor(type: string, parent: any) {\n    this.parent = parent\n    if (type === \"FILTER_AND\") {\n      this.type = \"FILTER_AND\";\n    } else if (type === \"FILTER_OR\") {\n      this.type = \"FILTER_OR\";\n    } else {\n      throw TypeError(\"Unexpected type for Group constructor\");\n    }\n  }\n\n  parent = null;\n  type = \"FILTER_OR\";\n  list: any[] = [];\n}\n","const traverse = (ast: any, options: any) => {\n  return ast;\n};\n\nexport default traverse;\n//\n// export const cutNode = (root: any, node: any) => {\n//   let visitor = root\n//   while(visitor) {\n//\n//     visitor = visitor.\n//   }\n// }\n\nexport const assignParentNode = (root: any) => {\n  let node = root.conditions;\n\n  function walk(walker: any) {\n    if (walker.list) {\n      for (let i = 0; i < walker.list.length; i++) {\n        walker.list[i].parent = walker;\n        walk(walker.list[i]);\n      }\n    }\n  }\n\n  if (node.list) {\n    node.parent = root;\n  }\n\n  walk(node);\n\n  return root;\n};\n\n\n\nexport const clearParentNode = (root: any) => {\n  let node = root.conditions;\n\n  function walk(walker: any) {\n    if (walker.list) {\n      for (let i = 0; i < walker.list.length; i++) {\n        delete walker.list[i].parent;\n        walk(walker.list[i]);\n      }\n    }\n  }\n\n  if (node.list) {\n    delete node.parent;\n  }\n\n  walk(node);\n\n  return root;\n};\n\n\n\n\nexport const validateNodes = (root: any, validator: Function) => {\n  let node = root.conditions;\n\n  function walk(walker: any) {\n    if (walker.list) {\n      for (let i = 0; i < walker.list.length; i++) {\n        validator(walker.list[i]);\n        walk(walker.list[i]);\n      }\n    }\n    if (walker.type === 'FILTER_NODE') {\n      validator(walker.action);\n      walk(walker.action);\n    }\n  }\n\n  walk(node);\n\n  return root;\n};\n","import React, { ReactNode, createContext, RefObject } from \"react\";\nimport cloneDeep from \"lodash/cloneDeep\";\nimport { DragDropContext, DragDropContextProvider } from \"react-dnd\";\nimport HTML5Backend from \"react-dnd-html5-backend\";\nimport Entry from \"./Entry\";\nimport Rule from \"../Domain/Rule\";\nimport Group from \"../Domain/Group\";\nimport {\n  assignParentNode,\n  clearParentNode,\n  validateNodes\n} from \"../utils/traverse\";\n\ninterface Props {\n  // ref: RefObject<object>;\n  filters: {\n    type: string;\n    conditions: {\n      type: string;\n    };\n  };\n}\n\ninterface State {\n  errors: any;\n  tree: any;\n  moveNode: any;\n  addNode: any;\n  collapseNode: any;\n  changeNodeType: any;\n  removeNode: any;\n  clearNodeAction: any;\n  clearErrors: any;\n  changeIDNodeValue: any;\n  changeDateNodeValue: any;\n  copyNode: any;\n}\n\nexport const FilterContext = createContext({\n  tree: null,\n  errors: null\n});\n\nexport default class Framework extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      errors: null,\n      tree: assignParentNode(props.filters),\n      moveNode: this.moveNode,\n      addNode: this.addNode,\n      collapseNode: this.collapseNode,\n      removeNode: this.removeNode,\n      copyNode: this.copyNode,\n      clearNodeAction: this.clearNodeAction,\n      clearErrors: this.clearErrors,\n      changeIDNodeValue: this.changeIDNodeValue,\n      changeDateNodeValue: this.changeDateNodeValue,\n      changeNodeType: this.changeNodeType\n    };\n  }\n  moveNode = (from: any, to: any) => {};\n  addNode = (node: string, to: any) => {\n    if (node === \"rule\") {\n      to.list.push(new Rule(\"TOPIC_ACTION\", to));\n      this.forceUpdate();\n    } else if (node === \"group\") {\n      to.list.push(new Group(\"FILTER_OR\", to));\n      this.forceUpdate();\n    } else {\n      throw TypeError(\"Unexpected node type, cannot be inserted\");\n    }\n    this.clearErrors();\n    // this.forceUpdate();\n  };\n  collapseNode = (node: any, filter: string = \"FILTER_OR\") => {\n    const group = new Group(filter, node.parent);\n    const index = node.parent.list.findIndex((t: any) => t === node);\n    if (node.type === \"FILTER_NODE\") {\n      node.parent.list[index] = group;\n      group.list = [node];\n      node.parent = group;\n    } else {\n      node.parent.list[index] = group;\n      group.list = [node];\n      node.parent = group;\n    }\n    // this.clearErrors();\n    this.forceUpdate();\n  };\n  changeNodeType = (node: any, type: string) => {\n    node.type = type;\n    this.clearErrors();\n    // this.forceUpdate();\n  };\n  changeIDNodeValue = (node: any, val: any) => {\n    node.id = val;\n    this.clearErrors();\n    // this.forceUpdate();\n  };\n  changeDateNodeValue = (node: any, val: any) => {\n    node.value = val;\n    this.clearErrors();\n    // this.forceUpdate();\n  };\n  clearNodeAction = (node: any) => {\n    if (node.type === \"FILTER_NODE\") {\n      Rule.prototype.clear.call(node);\n    }\n    // node.clear && node.clear();\n    this.clearErrors();\n    // this.forceUpdate();\n  };\n  removeNode = (node: any) => {\n    const index = node.parent.list.findIndex((t: any) => t === node);\n    node.parent.list.splice(index, 1);\n    this.clearErrors();\n    // this.forceUpdate();\n  };\n  copyNode = (node: any) => {\n    const index = node.parent.list.findIndex((t: any) => t === node);\n    node.parent.list.splice(index, 0, {\n      type: \"FILTER_NODE\",\n      action: cloneDeep(node.action),\n      range: cloneDeep(node.range),\n      parent: node.parent\n    });\n    // node.parent.list.splice(index, 0, cloneDeep(node));\n    this.clearErrors();\n    // this.forceUpdate();\n  };\n\n  /**\n   * 外部方法调用\n   */\n  getFieldsValue = () => {\n    if (this.validateFieldsValue()) {\n      return false;\n    }\n    return this.state.tree;\n  };\n\n  validateFieldsValue = () => {\n    const errors = new Map();\n    validateNodes(this.state.tree, (node: any) => {\n      if (node.type === \"FILTER_AND\" || node.type === \"FILTER_OR\") {\n        if (node.list.length === 0) errors.set(node, \"AND/OR筛选列表不能为空\");\n      }\n      if (node.type === \"USER_ACTION\" || node.type === \"TOPIC_ACTION\") {\n        if (!node.detail.action.id) errors.set(node, \"动作不能设置为空\");\n        if (!node.detail.target.id) errors.set(node, \"目标不能设置为空\");\n      }\n    });\n    this.setState({ errors });\n    return errors.size ? errors : null;\n  };\n\n  clearErrors = (node?: any) => {\n    if (!node) {\n      this.setState({ errors: null });\n      return;\n    }\n    this.state.errors.delete(node);\n    this.forceUpdate();\n  };\n\n  render(): ReactNode {\n    const { conditions } = this.state.tree;\n    if (!conditions) {\n      return null;\n    }\n\n    return (\n      <div>\n        <FilterContext.Provider value={this.state}>\n          <Entry node={conditions} />\n        </FilterContext.Provider>\n      </div>\n    );\n  }\n}\n","import Framework from './Framework/index'\n\nexport default Framework\n","export const walk = (node, depth) => {\n  const type = node.type;\n\n  const entries = {\n    SELECT: {\n      generate: n => {\n        return `SELECT ${n.selectList.map(walk)} FROM ${walk(n.source)}`;\n      }\n    },\n    COUNT: {\n      generate: n => {\n        return \"COUNT\";\n      }\n    },\n    SOURCE_LIST: {\n      generate: n => {\n        return `${n.source.map(t => `ID ${t.id}`).join(\",\")} ${walk(\n          n.filters\n        )}`;\n      }\n    },\n    WHERE: {\n      generate: n => {\n        if (n.conditions === null) {\n          return \"NULL\";\n        }\n        return `WHERE ${walk(n.conditions, 1)}`;\n      }\n    },\n    FILTER_AND: {\n      generate: (n, depth) => {\n        if (depth === 1) {\n          return `${n.list.map(n => walk(n)).join(\" \\nAND \")}`;\n        }\n        return `(\\n ${n.list.map(n => walk(n)).join(\" \\nAND \")} )`;\n      }\n    },\n    FILTER_OR: {\n      generate: (n, depth) => {\n        if (depth === 1) {\n          return `${n.list.map(n => walk(n)).join(\" \\nOR \")}`;\n        }\n        return `(\\n ${n.list.map(n => walk(n)).join(\" \\nOR \")} )`;\n      }\n    },\n    FILTER_NODE: {\n      generate: (n, depth) => {\n        if (n.range) {\n          return `${walk(n.action)} ${walk(n.range)}`;\n        }\n        if (n.action) {\n          return `${walk(n.action)}`;\n        }\n      }\n    },\n    USER_ACTION: {\n      generate: (n, depth) => {\n        return `USER DO ${walk(n.detail.action)} TO ${walk(n.detail.target)}`;\n      }\n    },\n    TOPIC_ACTION: {\n      generate: (n, depth) => {\n        return `TOPIC DO ${walk(n.detail.action)} TO ${walk(n.detail.target)}`;\n      }\n    },\n    ID_NODE: {\n      generate: n => {\n        if (n.comment) {\n          return `ID ${n.id} COMMENT \\`${n.comment}\\``;\n        }\n        return `ID ${n.id}`;\n      }\n    },\n    RANGE: {\n      generate: n => {\n        return `RANGE ${walk(n.from)} UNTIL ${walk(n.to)}`;\n      }\n    },\n    TIMESTAMP: {\n      generate: n => {\n        return n.value;\n      }\n    },\n    DATE: {\n      generate: n => {\n        return \"`\" + n.value + \"`\";\n      }\n    }\n  };\n\n  if (!entries[type]) {\n    console.info(type, entries[type]);\n    throw Error(type);\n  }\n\n  return entries[type].generate(node, depth);\n};\n","import React, { Component, createRef, RefObject } from \"react\";\nimport FilterBuidler from \"./packages/rock-builder/index\";\nimport logo from \"./logo.svg\";\nimport \"antd/dist/antd.min.css\";\nimport { Button, Input } from \"antd\";\nimport { walk } from \"./packages/rock-generator\";\n\nconst sample = {\n  type: \"SELECT\",\n  selectList: [\n    {\n      type: \"COUNT\"\n    }\n  ],\n  source: {\n    type: \"SOURCE_LIST\",\n    source: [\n      {\n        type: \"SOURCE_NODE\",\n        id: \"233\"\n      }\n    ],\n    filters: {\n      type: \"WHERE\",\n      conditions: {\n        type: \"FILTER_AND\",\n        list: [\n          {\n            type: \"FILTER_OR\",\n            list: [\n              {\n                type: \"FILTER_NODE\",\n                action: {\n                  type: \"USER_ACTION\",\n                  detail: {\n                    action: {\n                      type: \"ID_NODE\",\n                      id: \"1\"\n                    },\n                    target: {\n                      type: \"ID_NODE\",\n                      id: \"2\",\n                      comment: \"你是不是傻报表\"\n                    }\n                  }\n                },\n                range: {\n                  type: \"RANGE\",\n                  from: {\n                    type: \"TIMESTAMP\",\n                    value: 123\n                  },\n                  to: {\n                    type: \"TIMESTAMP\",\n                    value: 456\n                  }\n                }\n              },\n              {\n                type: \"FILTER_NODE\",\n                action: {\n                  type: \"USER_ACTION\",\n                  detail: {\n                    action: {\n                      type: \"ID_NODE\",\n                      id: \"13\"\n                    },\n                    target: {\n                      type: \"ID_NODE\",\n                      id: \"23\"\n                    }\n                  }\n                },\n                range: {\n                  type: \"RANGE\",\n                  from: {\n                    type: \"DATE\",\n                    value: \"2134123\"\n                  },\n                  to: {\n                    type: \"DATE\",\n                    value: \"23432434\"\n                  }\n                }\n              }\n            ]\n          },\n          {\n            type: \"FILTER_OR\",\n            list: [\n              {\n                type: \"FILTER_NODE\",\n                action: {\n                  type: \"USER_ACTION\",\n                  detail: {\n                    action: {\n                      type: \"ID_NODE\",\n                      id: \"4\"\n                    },\n                    target: {\n                      type: \"ID_NODE\",\n                      id: \"5\"\n                    }\n                  }\n                }\n              },\n              {\n                type: \"FILTER_NODE\",\n                action: {\n                  type: \"USER_ACTION\",\n                  detail: {\n                    action: {\n                      type: \"ID_NODE\",\n                      id: \"7\"\n                    },\n                    target: {\n                      type: \"ID_NODE\",\n                      id: \"8\"\n                    }\n                  }\n                }\n              },\n              {\n                type: \"FILTER_NODE\",\n                action: {\n                  type: \"TOPIC_ACTION\",\n                  detail: {\n                    action: {\n                      type: \"ID_NODE\",\n                      id: \"7\"\n                    },\n                    target: {\n                      type: \"ID_NODE\",\n                      id: \"8\"\n                    }\n                  }\n                }\n              },\n              {\n                type: \"FILTER_AND\",\n                list: [\n                  {\n                    type: \"FILTER_NODE\",\n                    action: {\n                      type: \"TOPIC_ACTION\",\n                      detail: {\n                        action: {\n                          type: \"ID_NODE\",\n                          id: \"7\"\n                        },\n                        target: {\n                          type: \"ID_NODE\",\n                          id: \"8\"\n                        }\n                      }\n                    }\n                  },\n                  {\n                    type: \"FILTER_NODE\",\n                    action: {\n                      type: \"TOPIC_ACTION\",\n                      detail: {\n                        action: {\n                          type: \"ID_NODE\",\n                          id: \"7\"\n                        },\n                        target: {\n                          type: \"ID_NODE\",\n                          id: \"8\"\n                        }\n                      }\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }\n};\n\nclass App extends Component {\n  state = {\n    text: \"\"\n  };\n  filterRef: RefObject<FilterBuidler> = createRef();\n  handleSubmit = () => {\n    if (this.filterRef.current) {\n      console.info(this.filterRef.current.getFieldsValue());\n    }\n  };\n  handleGenerate = () => {\n    if (this.filterRef.current) {\n      const res = this.filterRef.current.getFieldsValue();\n      if (res !== false) {\n        this.setState({\n          text: walk(this.filterRef.current.getFieldsValue())\n        });\n      }\n    }\n  };\n  render() {\n    return (\n      <div className=\"App\">\n        <FilterBuidler ref={this.filterRef} filters={sample.source.filters} />\n        <div>\n          <Button type=\"primary\" onClick={() => this.handleSubmit()}>\n            OK\n          </Button>\n          <Button onClick={() => this.handleGenerate()}>generate</Button>\n        </div>\n        <Input.TextArea value={this.state.text} autosize />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}